<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UDF | 薯片是只狗 的博客</title>
    <meta name="description" content="记录技术 享受技术">
    
    
    <link rel="preload" href="/assets/css/0.styles.7831d5ce.css" as="style"><link rel="preload" href="/assets/js/app.8b7d2c2c.js" as="script"><link rel="preload" href="/assets/js/2.a9aea45f.js" as="script"><link rel="preload" href="/assets/js/6.4ef9c1a3.js" as="script"><link rel="prefetch" href="/assets/js/10.5b26802a.js"><link rel="prefetch" href="/assets/js/11.49490cb2.js"><link rel="prefetch" href="/assets/js/12.ec61fe2a.js"><link rel="prefetch" href="/assets/js/13.6d9a21ca.js"><link rel="prefetch" href="/assets/js/3.d4fd7f6a.js"><link rel="prefetch" href="/assets/js/4.96ab7fb5.js"><link rel="prefetch" href="/assets/js/5.c5062d87.js"><link rel="prefetch" href="/assets/js/7.10626caa.js"><link rel="prefetch" href="/assets/js/8.aaba2fc6.js"><link rel="prefetch" href="/assets/js/9.543e80e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7831d5ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">薯片是只狗 的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/sourceRead/" class="nav-link">源码阅读</a></li><li class="dropdown-item"><!----> <a href="/java/effective/" class="nav-link">effective java</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bigdata/hive/UDF.html" class="nav-link router-link-exact-active router-link-active">hive UDF</a></li><li class="dropdown-item"><!----> <a href="/bigdata/hive/load files.html" class="nav-link">hive加载文件</a></li><li class="dropdown-item"><!----> <a href="/bigdata/hive/cmd.html" class="nav-link">hive常用命令</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂项" class="dropdown-title"><span class="title">杂项</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/mongodb/advance query.html" class="nav-link">mongodb高级查询</a></li><li class="dropdown-item"><!----> <a href="/other/data collect/data collect type.html" class="nav-link">数据收集埋点方式</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/sourceRead/" class="nav-link">源码阅读</a></li><li class="dropdown-item"><!----> <a href="/java/effective/" class="nav-link">effective java</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bigdata/hive/UDF.html" class="nav-link router-link-exact-active router-link-active">hive UDF</a></li><li class="dropdown-item"><!----> <a href="/bigdata/hive/load files.html" class="nav-link">hive加载文件</a></li><li class="dropdown-item"><!----> <a href="/bigdata/hive/cmd.html" class="nav-link">hive常用命令</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂项" class="dropdown-title"><span class="title">杂项</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/mongodb/advance query.html" class="nav-link">mongodb高级查询</a></li><li class="dropdown-item"><!----> <a href="/other/data collect/data collect type.html" class="nav-link">数据收集埋点方式</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/bigdata/hive/load files.html" class="sidebar-link">加载文件</a></li><li><a href="/bigdata/hive/UDF.html" class="active sidebar-link">UDF</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bigdata/hive/UDF.html#udf作用" class="sidebar-link">UDF作用</a></li><li class="sidebar-sub-header"><a href="/bigdata/hive/UDF.html#udf开发" class="sidebar-link">UDF开发</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="udf"><a href="#udf" class="header-anchor">#</a> UDF</h1> <h2 id="udf作用"><a href="#udf作用" class="header-anchor">#</a> UDF作用</h2> <p>处理hive sql语句解决不了的、或者解决很麻烦的问题，如解析JSON数组，通过GPS查询地理位置等。UDF的灵活性很高，可以解决上述问题。</p> <h2 id="udf开发"><a href="#udf开发" class="header-anchor">#</a> UDF开发</h2> <p>UDF可以继承GenericUDTF 或者继承 UDF。下面以解析数组字符串为例阐述UDF开发示例。</p> <h3 id="继承udf"><a href="#继承udf" class="header-anchor">#</a> 继承UDF</h3> <h4 id="代码开发"><a href="#代码开发" class="header-anchor">#</a> 代码开发</h4> <p>该方法比较简单，实现evaluate方法即可，注意入参和返回参数格式。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>iflytek<span class="token punctuation">.</span>auto<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>sparkUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson</span><span class="token punctuation">.</span><span class="token class-name">JSONArray</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson</span><span class="token punctuation">.</span><span class="token class-name">JSONException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>exec</span><span class="token punctuation">.</span>UDF<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JsonArrayParseSimpleUdf</span> <span class="token keyword">extends</span> UDF <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">String</span> jsonString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 校验入参</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>jsonString <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 解析json array</span>
            <span class="token class-name">JSONArray</span> extractObject <span class="token operator">=</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> extractObject<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>extractObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h4> <p>解析&quot;[1,2,3,4]&quot;</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJsonArraySimpleParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">HiveException</span> <span class="token punctuation">{</span>
    <span class="token class-name">JsonArrayParseSimpleUdf</span> jsonArrayParseSimpleUdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonArrayParseSimpleUdf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> jsonArrayParseSimpleUdf<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token string">&quot;[1,2,3,4]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------udf start parse-----------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> str <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------udf end parse------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="测试结果"><a href="#测试结果" class="header-anchor">#</a> 测试结果</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>udf start parse<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>udf end parse<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> exit code <span class="token number">0</span>
</code></pre></div><h3 id="继承genericudf"><a href="#继承genericudf" class="header-anchor">#</a> 继承GenericUDF</h3> <h4 id="代码开发-2"><a href="#代码开发-2" class="header-anchor">#</a> 代码开发</h4> <p>需要实现initialize(ObjectInspector[] args)，evaluate(DeferredObject[] deferredObjects)，getDisplayString(String[] strings)方法。</p> <ul><li>initialize方法主要用于参数校验，定义数据输出格式；</li> <li>evaluate主要用于数据处理；</li> <li>getDisplayString 在explain时展示的信息（Get the String to be displayed in explain.）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>iflytek<span class="token punctuation">.</span>auto<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>sparkUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson</span><span class="token punctuation">.</span>JSON<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson</span><span class="token punctuation">.</span><span class="token class-name">JSONArray</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>exec</span><span class="token punctuation">.</span><span class="token class-name">UDFArgumentException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>metadata</span><span class="token punctuation">.</span><span class="token class-name">HiveException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>generic</span><span class="token punctuation">.</span><span class="token class-name">GenericUDF</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>objectinspector</span><span class="token punctuation">.</span><span class="token class-name">ListObjectInspector</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>objectinspector</span><span class="token punctuation">.</span><span class="token class-name">ObjectInspector</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>objectinspector</span><span class="token punctuation">.</span><span class="token class-name">ObjectInspectorFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>objectinspector<span class="token punctuation">.</span>primitive</span><span class="token punctuation">.</span><span class="token class-name">PrimitiveObjectInspectorFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>serde2<span class="token punctuation">.</span>objectinspector<span class="token punctuation">.</span>primitive</span><span class="token punctuation">.</span><span class="token class-name">StringObjectInspector</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JsonArrayParseUdf</span> <span class="token keyword">extends</span> <span class="token class-name">GenericUDF</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用于读取输入数据</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">StringObjectInspector</span> stringIO <span class="token operator">=</span> <span class="token class-name">PrimitiveObjectInspectorFactory</span><span class="token punctuation">.</span>javaStringObjectInspector<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 校验输入数据是否正确
     * 指定输出数据格式（即返回值）
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ListObjectInspector</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">ObjectInspector</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UDFArgumentException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UDFArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;input args length error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ObjectInspectorFactory</span><span class="token punctuation">.</span><span class="token function">getStandardListObjectInspector</span><span class="token punctuation">(</span><span class="token class-name">PrimitiveObjectInspectorFactory</span><span class="token punctuation">.</span>javaStringObjectInspector<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">DeferredObject</span><span class="token punctuation">[</span><span class="token punctuation">]</span> deferredObjects<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">HiveException</span> <span class="token punctuation">{</span>
        <span class="token class-name">DeferredObject</span> inputObj <span class="token operator">=</span> deferredObjects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jsonStr <span class="token operator">=</span> stringIO<span class="token punctuation">.</span><span class="token function">getPrimitiveJavaObject</span><span class="token punctuation">(</span>inputObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JSONArray</span> arr <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDisplayString</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;JsonArrayParse&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="测试-2"><a href="#测试-2" class="header-anchor">#</a> 测试</h4> <p>解析&quot;[1,2,3,4]&quot;</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testJsonArrayParse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">HiveException</span> <span class="token punctuation">{</span>
    <span class="token class-name">JsonArrayParseUdf</span> jsonArrayParseUdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonArrayParseUdf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">GenericUDF</span><span class="token punctuation">.</span><span class="token class-name">DeferredObject</span> defObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericUDF</span><span class="token punctuation">.</span><span class="token class-name">DeferredJavaObject</span><span class="token punctuation">(</span><span class="token string">&quot;[1,2,3,4]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects <span class="token operator">=</span> jsonArrayParseUdf<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericUDF</span><span class="token punctuation">.</span><span class="token class-name">DeferredObject</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>defObj<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------generic start parse-----------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------generic end parse------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="测试结果-2"><a href="#测试结果-2" class="header-anchor">#</a> 测试结果</h4> <div class="language- extra-class"><pre class="language-text"><code>---------generic start parse-----------
1
2
3
4
------------generic end parse------------

Process finished with exit code 0
</code></pre></div><p>ObjectInspector：Serde实现数据序列化和反序列化以及提供一个辅助类ObjectInspector帮助使用者访问需要序列化或者反序列化的对象。</p> <p>DeferredObject :A Defered Object allows us to do lazy-evaluation and short-circuiting. GenericUDF use DeferedObject to pass arguments.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/bigdata/hive/load files.html" class="prev">加载文件</a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8b7d2c2c.js" defer></script><script src="/assets/js/2.a9aea45f.js" defer></script><script src="/assets/js/6.4ef9c1a3.js" defer></script>
  </body>
</html>
